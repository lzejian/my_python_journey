name: æ¯æ—¥åŸºé‡‘ç­–ç•¥ (å«è®°å¿†åŠŸèƒ½)

on:
  schedule:
    # åŒ—äº¬æ—¶é—´ 14:45 = UTCæ—¶é—´ 06:45
    # å»ºè®®è®¾ä¸º 06:40ï¼Œç•™ä¸€ç‚¹ç¼“å†²æ—¶é—´
    - cron: '40 6 * * 1-5'  # 1-5ä»£è¡¨å‘¨ä¸€åˆ°å‘¨äº”ï¼Œå‘¨æœ«è‡ªåŠ¨ä¼‘æ¯ï¼
  
  # å…è®¸æ‰‹åŠ¨ç‚¹æŒ‰é’®è§¦å‘æµ‹è¯•
  workflow_dispatch:

jobs:
  run_strategies:
    runs-on: ubuntu-latest
    
    steps:
    - name: 1. æ‹‰å–ä»“åº“ä»£ç 
      uses: actions/checkout@v3
      
    - name: 2. è®¾ç½® Python ç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: 3. å®‰è£…ä¾èµ–åº“
      run: pip install akshare requests pandas

    - name: 4. è¿è¡Œçº³æŒ‡ç­–ç•¥
      # å³ä½¿æŠ¥é”™ä¹Ÿè¦ç»§ç»­è·‘ä¸‹ä¸€æ­¥ï¼Œé˜²æ­¢çº³æŒ‡æŒ‚äº†å½±å“é»„é‡‘
      continue-on-error: true 
      run: python smart_strategy.py
      
    - name: 5. è¿è¡Œé»„é‡‘ç­–ç•¥
      continue-on-error: true
      run: python gold_strategy.py

    - name: 6. ã€æ ¸å¿ƒã€‘ä¿å­˜è®°å¿† (Git Push)
      run: |
        # é…ç½®ä¸€ä¸ªè™šæ‹Ÿçš„ git ç”¨æˆ·
        git config --global user.name "GitHub Action Bot"
        git config --global user.email "actions@github.com"
        
        # æ£€æŸ¥æœ‰æ²¡æœ‰ json æ–‡ä»¶å˜åŒ–
        git add *.json
        
        # å¦‚æœæœ‰å˜åŒ–ï¼Œå°±æäº¤ï¼›æ²¡å˜åŒ–(æ¯”å¦‚å‘¨æœ«)å°±è·³è¿‡
        if git diff --staged --quiet; then
          echo "ğŸ“… æ•°æ®æ— å˜åŒ–ï¼Œæ— éœ€ä¿å­˜"
        else
          git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–°ç­–ç•¥è®°å¿†æ•°æ® [skip ci]"
          git push
          echo "âœ… è®°å¿†æ•°æ®å·²ä¿å­˜å›ä»“åº“"
        fi
